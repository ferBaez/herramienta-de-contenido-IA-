<!DOCTYPE html>
<html lang="es">
<head>
    <!-- ============== SEO METADATOS ESENCIALES ============== -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kit de Herramientas de Contenido con IA | Generador SEO y Optimizador de Im√°genes</title>
    <meta name="description" content="Potencia tu marketing digital con nuestro kit de herramientas de IA. Genera textos SEO, hashtags, CTA, prueba t√≠tulos para alto CTR y optimiza im√°genes para web con un solo clic.">
    <meta name="keywords" content="generador seo, optimizaci√≥n de im√°genes, herramientas de marketing, inteligencia artificial, hashtags, CTA, alto CTR, marketing de contenidos, hitster ai, repurpose content, reutilizar contenido, webp, texto alternativo">
    <meta name="author" content="Hitster Ai">
    
    <!-- ============== ETIQUETAS OPEN GRAPH (PARA REDES SOCIALES) ============== -->
    <meta property="og:title" content="Kit de Herramientas de Contenido con IA | Generador SEO y Optimizador">
    <meta property="og:description" content="Genera textos, hashtags y CTA optimizados para SEO. Reutiliza contenido y optimiza im√°genes para web al instante con el poder de la IA.">
    <meta property="og:type" content="website">
    <!-- IMPORTANTE: Reemplaza la URL de abajo con la URL final de tu sitio en GitHub Pages -->
    <meta property="og:url" content="https://TU_USUARIO_DE_GITHUB.github.io/TU_REPOSITORIO/">
    <meta property="og:image" content="https://placehold.co/1200x630/4f46e5/ffffff?text=Kit+de+Contenido+IA">
    <meta property="og:image:alt" content="Una imagen mostrando el logo y el t√≠tulo del Kit de Herramientas de Contenido con IA">

    <!-- ============== ETIQUETAS TWITTER CARD ============== -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Kit de Herramientas de Contenido con IA | Generador SEO y Optimizador">
    <meta name="twitter:description" content="Genera textos, hashtags y CTA optimizados para SEO. Reutiliza contenido y optimiza im√°genes para web al instante con el poder de la IA.">
    <!-- IMPORTANTE: Reemplaza la URL de la imagen si tienes una propia -->
    <meta name="twitter:image" content="https://placehold.co/1200x630/4f46e5/ffffff?text=Kit+de+Contenido+IA">

    <!-- ============== URL CAN√ìNICA ============== -->
    <!-- IMPORTANTE: Reemplaza la URL de abajo con la URL final de tu sitio en GitHub Pages -->
    <link rel="canonical" href="https://TU_USUARIO_DE_GITHUB.github.io/TU_REPOSITORIO/">
    
    <!-- ============== ESTILOS Y FUENTES ============== -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .transition-all-ease { transition: all 0.3s ease-in-out; }
        .tab-active { background-color: #4f46e5; color: white; }
        .dark .tab-active { background-color: #6366f1; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #4f46e5; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        .dark .loader { border: 4px solid #4b5563; border-top: 4px solid #6366f1; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        input[type="file"]::file-selector-button { @apply bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg cursor-pointer hover:bg-indigo-700 transition-all-ease; }
        .dark input[type="file"]::file-selector-button { @apply bg-indigo-500 hover:bg-indigo-600; }
        .output-card { @apply bg-gray-100 dark:bg-gray-700 p-4 rounded-lg; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-all-ease flex flex-col min-h-screen">

    <div class="flex-grow container mx-auto p-4 md:p-8 max-w-5xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-indigo-600 dark:text-indigo-400">Kit de Herramientas de Contenido con IA</h1>
            <p class="mt-2 text-lg text-gray-600 dark:text-gray-400">Genera, reutiliza y optimiza tu contenido con el poder de la IA.</p>
        </header>

        <!-- Tabs for navigation -->
        <div class="mb-8 flex flex-col sm:flex-row justify-center bg-gray-200 dark:bg-gray-800 rounded-lg p-1 max-w-sm sm:max-w-lg mx-auto">
            <button id="tab-seo" class="tab flex-1 py-2 px-4 rounded-md font-semibold transition-all-ease tab-active">Generador SEO</button>
            <button id="tab-repurpose" class="tab flex-1 py-2 px-4 rounded-md font-semibold transition-all-ease">Reutilizar Contenido</button>
            <button id="tab-image" class="tab flex-1 py-2 px-4 rounded-md font-semibold transition-all-ease">Optimizador de Imagen</button>
        </div>

        <!-- SEO Generator Section -->
        <main id="seo-section" class="space-y-6">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold mb-4 text-center">1. Generador de Contenido para Redes Sociales</h2>
                <div class="flex flex-col items-center gap-8">
                    <!-- Inputs -->
                    <div class="space-y-4 w-full max-w-lg">
                        <div>
                            <label for="topic" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Describe el tema de tu publicaci√≥n:</label>
                            <textarea id="topic" rows="4" class="mt-1 block w-full rounded-md bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="Ej: Lanzamiento de un nuevo curso online sobre marketing digital..."></textarea>
                        </div>
                        <div>
                            <label for="platform" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Elige la Red Social:</label>
                            <select id="platform" class="mt-1 block w-full rounded-md bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                <option>Instagram</option>
                                <option>Facebook</option>
                                <option>YouTube (t√≠tulo y descripci√≥n)</option>
                                <option>TikTok (descripci√≥n)</option>
                                <option>X (antes Twitter)</option>
                                <option>LinkedIn</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                             <button id="generate-seo-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-indigo-500 dark:hover:bg-indigo-600 transition-all-ease">
                                ‚ú® Generar Contenido Completo
                            </button>
                            <button id="generate-ab-btn" class="w-full bg-purple-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 dark:bg-purple-500 dark:hover:bg-purple-600 transition-all-ease">
                                ‚ú® Probar T√≠tulos (A/B Test)
                            </button>
                        </div>
                    </div>
                    <!-- Outputs Column -->
                    <div class="relative min-h-[300px] w-full max-w-lg">
                        <div id="seo-loader" class="hidden absolute inset-0 justify-center items-center bg-white/50 dark:bg-gray-800/50 rounded-lg z-10"><div class="loader"></div></div>
                        <div id="seo-output" class="space-y-4 hidden">
                            <div>
                                <h3 class="font-semibold text-lg flex justify-between items-center">T√≠tulo Atractivo <button class="copy-btn" data-target="attractive-title">üìã</button></h3>
                                <div id="attractive-title" class="mt-1 p-3 rounded-md bg-gray-100 dark:bg-gray-700 min-h-[50px]"></div>
                            </div>
                            <div>
                                <h3 class="font-semibold text-lg flex justify-between items-center">Descripci√≥n con CTA <button class="copy-btn" data-target="description-text">üìã</button></h3>
                                <div id="description-text" class="mt-1 p-3 rounded-md bg-gray-100 dark:bg-gray-700 whitespace-pre-wrap min-h-[100px]"></div>
                            </div>
                            <div>
                                <h3 class="font-semibold text-lg flex justify-between items-center">Hashtags <button class="copy-btn" data-target="hashtags">üìã</button></h3>
                                <div id="hashtags" class="mt-1 p-3 rounded-md bg-gray-100 dark:bg-gray-700"></div>
                            </div>
                            <div>
                                <h3 class="font-semibold text-lg flex justify-between items-center">Palabras Clave (Keywords) <button class="copy-btn" data-target="keywords">üìã</button></h3>
                                <div id="keywords" class="mt-1 p-3 rounded-md bg-gray-100 dark:bg-gray-700"></div>
                            </div>
                        </div>
                        <div id="ab-test-output" class="space-y-4 hidden">
                             <h3 class="font-semibold text-lg">Sugerencias de T√≠tulos para Prueba A/B</h3>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Repurpose Content Section -->
        <main id="repurpose-section" class="hidden space-y-6">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold mb-4 text-center">2. Reutilizador de Contenido M√°gico</h2>
                <div class="flex flex-col items-center gap-8">
                     <!-- Inputs -->
                    <div class="space-y-4 w-full max-w-lg">
                         <div>
                            <label for="long-text" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Pega tu art√≠culo, transcripci√≥n o texto largo aqu√≠:</label>
                            <textarea id="long-text" rows="8" class="mt-1 block w-full rounded-md bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="Pega el contenido que quieres transformar..."></textarea>
                        </div>
                        <button id="repurpose-btn" class="w-full bg-teal-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 dark:bg-teal-500 dark:hover:bg-teal-600 transition-all-ease">
                            ‚ú® ¬°Reutilizar M√°gicamente!
                        </button>
                    </div>
                     <!-- Outputs Column -->
                    <div class="relative w-full max-w-2xl">
                        <div id="repurpose-loader" class="hidden absolute inset-0 justify-center items-center bg-white/50 dark:bg-gray-800/50 rounded-lg z-10"><div class="loader"></div></div>
                        <div id="repurpose-output" class="hidden space-y-6">
                            <!-- Content will be injected by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </main>


        <!-- Image Optimizer Section -->
        <main id="image-section" class="hidden space-y-6">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold mb-4 text-center">3. Optimizador de Im√°genes para Web</h2>
                <div class="flex flex-col items-center gap-6">
                    <div class="w-full max-w-lg">
                        <label for="image-upload" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Sube una imagen para optimizarla:</label>
                        <input id="image-upload" type="file" accept="image/png, image/jpeg, image/gif" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 dark:file:bg-indigo-900 file:text-indigo-700 dark:file:text-indigo-300 hover:file:bg-indigo-100 dark:hover:file:bg-indigo-800"/>
                    </div>
                    <div id="image-loader" class="hidden justify-center items-center mt-6 w-full"><div class="loader"></div><p class="ml-4">Analizando y optimizando...</p></div>
                    <div id="image-output" class="hidden grid grid-cols-1 md:grid-cols-2 gap-6 mt-6 w-full max-w-4xl">
                        <div>
                            <h3 class="font-semibold text-lg mb-2">Original</h3>
                            <img id="original-image" src="" alt="Imagen Original" class="rounded-lg shadow-md w-full">
                            <p id="original-size" class="text-sm mt-2 text-center"></p>
                        </div>
                        <div>
                            <h3 class="font-semibold text-lg mb-2">Optimizada (WebP)</h3>
                            <img id="optimized-image" src="" alt="Imagen Optimizada" class="rounded-lg shadow-md w-full">
                            <p id="optimized-size" class="text-sm mt-2 text-center font-bold"></p>
                        </div>
                        <div class="md:col-span-2 mt-4 space-y-4">
                            <div>
                                <label for="alt-text" class="block text-sm font-medium text-gray-700 dark:text-gray-300 flex justify-between items-center">Texto Alternativo (Alt Text) por IA <button class="copy-btn" data-target="alt-text-input">üìã</button></label>
                                <input type="text" id="alt-text-input" class="mt-1 block w-full rounded-md bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                            </div>
                            <a id="download-btn" href="#" download="optimized_image.webp" class="w-full block text-center bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:bg-green-500 dark:hover:bg-green-600 transition-all-ease">
                                ‚¨áÔ∏è Descargar Imagen Optimizada
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <footer class="text-center p-4 mt-8 border-t border-gray-200 dark:border-gray-800">
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">
            Dise√±ado por Hitster Ai | <a href="mailto:baez@hitster.page" class="text-indigo-600 dark:text-indigo-400 hover:underline">Cont√°ctanos</a>
        </p>
        <p class="text-sm text-gray-500 dark:text-gray-400">
            &copy; 2025 Todos los derechos reservados para Hitster Ai
        </p>
    </footer>
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-900 py-2 px-4 rounded-lg shadow-xl opacity-0 translate-y-10 transition-all duration-300">
        Copiado al portapapeles!
    </div>

    <script type="module">
        // --- Navigation ---
        const tabs = {
            seo: { btn: document.getElementById('tab-seo'), section: document.getElementById('seo-section') },
            repurpose: { btn: document.getElementById('tab-repurpose'), section: document.getElementById('repurpose-section') },
            image: { btn: document.getElementById('tab-image'), section: document.getElementById('image-section') }
        };

        function switchTab(activeKey) {
            Object.keys(tabs).forEach(key => {
                const is_active = key === activeKey;
                tabs[key].btn.classList.toggle('tab-active', is_active);
                tabs[key].section.classList.toggle('hidden', !is_active);
            });
        }

        tabs.seo.btn.addEventListener('click', () => switchTab('seo'));
        tabs.repurpose.btn.addEventListener('click', () => switchTab('repurpose'));
        tabs.image.btn.addEventListener('click', () => switchTab('image'));
        
        // --- Toast Notification ---
        const toast = document.getElementById('toast');
        function showToast() {
            toast.classList.remove('opacity-0', 'translate-y-10');
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-10');
            }, 2000);
        }

        // --- Copy to Clipboard ---
        document.body.addEventListener('click', (event) => {
            const copyBtn = event.target.closest('.copy-btn');
            if (copyBtn) {
                event.preventDefault();
                const targetId = copyBtn.dataset.target;
                const element = document.getElementById(targetId);
                const textToCopy = element.value !== undefined ? element.value : element.innerText;

                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showToast();
                } catch (err) {
                    console.error('Fallback: Oops, unable to copy', err);
                }
                document.body.removeChild(textArea);
            }
        });

        // --- Gemini API Call Function ---
        async function callGemini(payload) {
            const apiKey = ""; // API Key is handled by the environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const result = await response.json();
                if (result.candidates?.[0]?.content?.parts?.[0]) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    console.error("API response structure is unexpected:", result);
                    if(result.candidates?.[0]?.finishReason === 'SAFETY') {
                       return JSON.stringify({ error: "No se pudo generar el contenido debido a pol√≠ticas de seguridad. Intenta con un tema diferente." });
                    }
                    return JSON.stringify({ error: "No se recibi√≥ una respuesta v√°lida de la IA." });
                }
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                return JSON.stringify({ error: "Error al comunicarse con la IA. Revisa la consola para m√°s detalles." });
            }
        }
        
        // --- SEO GENERATOR ---
        const generateSeoBtn = document.getElementById('generate-seo-btn');
        const generateAbBtn = document.getElementById('generate-ab-btn');
        const topicInput = document.getElementById('topic');
        const platformSelect = document.getElementById('platform');
        const seoOutput = document.getElementById('seo-output');
        const abTestOutput = document.getElementById('ab-test-output');
        const seoLoader = document.getElementById('seo-loader');
        const attractiveTitleDiv = document.getElementById('attractive-title');
        const descriptionTextDiv = document.getElementById('description-text');
        const hashtagsDiv = document.getElementById('hashtags');
        const keywordsDiv = document.getElementById('keywords');

        function validateTopic() {
            if (!topicInput.value.trim()) {
                alert("Por favor, describe el tema de tu publicaci√≥n.");
                return false;
            }
            return true;
        }

        function showLoader(loaderEl, show) {
            loaderEl.classList.toggle('hidden', !show);
            loaderEl.classList.toggle('flex', show);
        }

        generateSeoBtn.addEventListener('click', async () => {
            if (!validateTopic()) return;
            
            seoOutput.classList.add('hidden');
            abTestOutput.classList.add('hidden');
            showLoader(seoLoader, true);

            const prompt = `Act√∫a como un copywriter experto en marketing digital y SEO, especializado en crear contenido con un alto CTR (Click-Through Rate). Basado en el siguiente tema, genera contenido para la red social ${platformSelect.value}. Tema: "${topicInput.value}". Proporciona tu respuesta en formato JSON con las claves EXACTAS: "title", "description", "hashtags", "keywords". - "title": Un t√≠tulo corto, magn√©tico y muy atractivo (m√°ximo 15 palabras). - "description": Un texto de descripci√≥n persuasivo con emojis y una CTA potente. - "hashtags": Una cadena de texto con 10-15 hashtags relevantes. - "keywords": Una cadena de texto con 5-7 palabras clave para SEO, separadas por comas.`;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json" } };
            const resultText = await callGemini(payload);

            try {
                const resultJson = JSON.parse(resultText);
                if (resultJson.error) {
                    attractiveTitleDiv.innerText = resultJson.error;
                    [descriptionTextDiv, hashtagsDiv, keywordsDiv].forEach(el => el.innerText = '');
                } else {
                    attractiveTitleDiv.innerText = resultJson.title || 'N/A';
                    descriptionTextDiv.innerText = resultJson.description || 'N/A';
                    hashtagsDiv.innerText = resultJson.hashtags || 'N/A';
                    keywordsDiv.innerText = resultJson.keywords || 'N/A';
                }
            } catch (e) {
                console.error("Failed to parse JSON response:", e);
                attractiveTitleDiv.innerText = "Error: La respuesta de la IA no ten√≠a el formato esperado.";
                 [descriptionTextDiv, hashtagsDiv, keywordsDiv].forEach(el => el.innerText = '');
            }

            showLoader(seoLoader, false);
            seoOutput.classList.remove('hidden');
        });

        generateAbBtn.addEventListener('click', async () => {
            if (!validateTopic()) return;

            seoOutput.classList.add('hidden');
            abTestOutput.classList.add('hidden');
            showLoader(seoLoader, true);

            const prompt = `Act√∫a como un copywriter de clase mundial. Basado en el tema "${topicInput.value}", genera 3 variaciones de t√≠tulos magn√©ticos para una publicaci√≥n en ${platformSelect.value}. El objetivo es una prueba A/B. Proporciona tu respuesta en formato JSON: un array de objetos, donde cada objeto tiene las claves "title" y "angle". - "title": El t√≠tulo sugerido (m√°ximo 15 palabras). - "angle": Una explicaci√≥n muy breve de la estrategia de copywriting.`;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json" } };
            const resultText = await callGemini(payload);
            
            abTestOutput.innerHTML = '<h3 class="font-semibold text-lg">Sugerencias de T√≠tulos para Prueba A/B</h3>'; // Reset

            try {
                const results = JSON.parse(resultText);
                if (results.error) {
                    abTestOutput.innerHTML += `<p>${results.error}</p>`;
                } else if (Array.isArray(results)) {
                    results.forEach((item, index) => {
                        const titleId = `ab-title-${index}`;
                        const html = `<div class="output-card"><div class="flex justify-between items-center"><p id="${titleId}" class="font-bold text-indigo-600 dark:text-indigo-400">${item.title || 'N/A'}</p><button class="copy-btn text-xl" data-target="${titleId}">üìã</button></div><p class="text-sm text-gray-600 dark:text-gray-400 mt-1">${item.angle || 'Sin estrategia.'}</p></div>`;
                        abTestOutput.innerHTML += html;
                    });
                }
            } catch (e) {
                console.error("Failed to parse A/B test JSON response:", e);
                abTestOutput.innerHTML += "<p>Error: La respuesta de la IA no ten√≠a el formato esperado.</p>";
            }

            showLoader(seoLoader, false);
            abTestOutput.classList.remove('hidden');
        });

        // --- REPURPOSE CONTENT ---
        const repurposeBtn = document.getElementById('repurpose-btn');
        const longTextInput = document.getElementById('long-text');
        const repurposeOutput = document.getElementById('repurpose-output');
        const repurposeLoader = document.getElementById('repurpose-loader');

        repurposeBtn.addEventListener('click', async () => {
            if (!longTextInput.value.trim()) {
                alert("Por favor, pega el contenido que deseas reutilizar.");
                return;
            }
            
            repurposeOutput.classList.add('hidden');
            showLoader(repurposeLoader, true);

            const prompt = `Eres un estratega de contenido experto en reutilizar contenido. He aqu√≠ un texto largo. Transf√≥rmalo en una serie de publicaciones para redes sociales, optimizadas para X (Twitter), Instagram y LinkedIn. Devuelve un √∫nico objeto JSON con las claves "twitter_thread", "instagram_carousel", y "linkedin_post".\n\n- "twitter_thread": Un array de 3-5 strings, donde cada string es un tweet de un hilo.\n- "instagram_carousel": Un array de 5 objetos, cada uno con "slide_title" y "slide_content". El √∫ltimo slide debe tener un CTA.\n- "linkedin_post": Un string con un post profesional y perspicaz para LinkedIn, con hashtags profesionales.\n\nTexto Original:\n"""\n${longTextInput.value}\n"""`;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json" } };
            const resultText = await callGemini(payload);

            repurposeOutput.innerHTML = ''; // Reset
            try {
                const resultJson = JSON.parse(resultText);
                if (resultJson.error) {
                     repurposeOutput.innerHTML = `<p>${resultJson.error}</p>`;
                } else {
                    // Twitter
                    if (resultJson.twitter_thread) {
                        let threadHtml = resultJson.twitter_thread.map((tweet, i) => `<p class="border-b border-gray-200 dark:border-gray-600 pb-2 mb-2">${i+1}. ${tweet}</p>`).join('');
                        const threadId = 'repurpose-twitter';
                        repurposeOutput.innerHTML += `<div class="output-card"><h4 class="font-bold text-lg mb-2 flex justify-between">Hilo de X/Twitter <button class="copy-btn" data-target="${threadId}">üìã</button></h4><div id="${threadId}">${threadHtml}</div></div>`;
                    }
                    // Instagram
                    if (resultJson.instagram_carousel) {
                         let carouselHtml = resultJson.instagram_carousel.map((slide, i) => `<div class="border-b border-gray-200 dark:border-gray-600 pb-2 mb-2"><p class="font-semibold">${i+1}. ${slide.slide_title}</p><p>${slide.slide_content}</p></div>`).join('');
                         const carouselId = 'repurpose-instagram';
                         repurposeOutput.innerHTML += `<div class="output-card"><h4 class="font-bold text-lg mb-2 flex justify-between">Carrusel de Instagram <button class="copy-btn" data-target="${carouselId}">üìã</button></h4><div id="${carouselId}">${carouselHtml}</div></div>`;
                    }
                     // LinkedIn
                    if (resultJson.linkedin_post) {
                        const linkedInId = 'repurpose-linkedin';
                        repurposeOutput.innerHTML += `<div class="output-card"><h4 class="font-bold text-lg mb-2 flex justify-between">Publicaci√≥n de LinkedIn <button class="copy-btn" data-target="${linkedInId}">üìã</button></h4><p id="${linkedInId}" class="whitespace-pre-wrap">${resultJson.linkedin_post}</p></div>`;
                    }
                }
            } catch (e) {
                 console.error("Failed to parse Repurpose JSON response:", e);
                 repurposeOutput.innerHTML += "<p>Error: La respuesta de la IA no ten√≠a el formato esperado.</p>";
            }

            showLoader(repurposeLoader, false);
            repurposeOutput.classList.remove('hidden');
        });

        // --- IMAGE OPTIMIZER ---
        const imageUpload = document.getElementById('image-upload');
        const imageLoader = document.getElementById('image-loader');
        const imageOutput = document.getElementById('image-output');
        const originalImage = document.getElementById('original-image');
        const originalSize = document.getElementById('original-size');
        const optimizedImage = document.getElementById('optimized-image');
        const optimizedSize = document.getElementById('optimized-size');
        const altTextInput = document.getElementById('alt-text-input');
        const downloadBtn = document.getElementById('download-btn');

        imageUpload.addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            imageOutput.classList.add('hidden');
            showLoader(imageLoader, true);
            
            originalImage.src = URL.createObjectURL(file);
            originalSize.textContent = `Tama√±o: ${(file.size / 1024).toFixed(2)} KB`;

            const optimizedBlob = await optimizeImage(file);
            optimizedImage.src = URL.createObjectURL(optimizedBlob);
            downloadBtn.href = optimizedImage.src;
            
            const sizeReduction = 100 - (optimizedBlob.size / file.size) * 100;
            optimizedSize.innerHTML = `Tama√±o: ${(optimizedBlob.size / 1024).toFixed(2)} KB <span class="text-green-500">(${sizeReduction.toFixed(1)}% menos)</span>`;
            
            const base64Data = await fileToBase64(file);
            const prompt = "Describe esta imagen de forma concisa para el atributo 'alt text' de una p√°gina web. S√© descriptivo pero breve.";
            const payload = { contents: [{ role: "user", parts: [ { text: prompt }, { inlineData: { mimeType: file.type, data: base64Data } } ] }] };
            const altText = await callGemini(payload);
            altTextInput.value = altText.replace(/['"`]/g, '');

            showLoader(imageLoader, false);
            imageOutput.classList.remove('hidden');
            imageOutput.classList.add('grid');
        });

        function optimizeImage(file, quality = 0.8) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = e => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        canvas.getContext('2d').drawImage(img, 0, 0);
                        canvas.toBlob(blob => resolve(blob), 'image/webp', quality);
                    };
                    img.onerror = reject;
                };
                reader.onerror = reject;
            });
        }
        
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
            });
        }
        
        // Initialize with the first tab active
        switchTab('seo');
    </script>
</body>
</html>
